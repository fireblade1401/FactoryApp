# FactoryApp
**Документация запросов для Factory App**

# **Описание**

С помощью Django и Django REST Framework написать API для приёма сообщений и
отправки их в Telegram бот.
Функционал готового задания должен выглядеть следующим образом: через API
получаем сообщение, его потом отправляем в Telegram бот.
Схема работы:

1. Пользователь регистрируется в нашей системе. При регистрации указывает
логин, пароль и имя

2. Пользователь находит бота в Telegram и подписывается на него. На этом этапе
требуется создать Telegram бота.

3. В личном кабинете генерирует токен и привязывает этот токен к своему чату.
Простой способ реализации: любое входящее сообщение от пользователя бот
запоминает как токен пользователя.

4. Пользователь отправляет на API своё сообщение. В этот момент бот сразу
дублирует его в Telegram. Пользователь должен получать только свои
сообщения.

## **Установка проекта локально**

**Локальная установка**

1. Для проверки локальной работоспособности проекта, сначала нужно его склонировать командой:
   ```
   git clone git@github.com:fireblade1401/FactoryApp.git
   ```
2. Далее, вам нужно перейти в директорию проекта, и в файле FactoryApp/settings.py:
   ```
   CELERY_BROKER_URL = 'redis://redis:6379/0'
   ```
   и поменять эту переменную на такое значение:
   ```
   CELERY_BROKER_URL = 'redis://localhost:6379/0'
   ```

3. Теперь, запустите докер композер билд :)   

   ```
    sudo docker-compose up --build
   ```

   Удачи в тестировании :)

## **Все запросы тестировались в Postman утилите!!**

1. **Регистрация пользователя**:

      URL: http://128.199.28.35/api/users/register/
    
      Метод: POST
    
      Тело запроса:

    ```
      {
            "username": "желаемое_имя_пользователя",
            "password": "желаемый_пароль"
      }
    ```

2. **Авторизация**:

   URL: http://128.199.28.35/auth/token/

   Метод: POST

   Тело запроса:

    ```
     {
           "username": "желаемое_имя_пользователя",
           "password": "желаемый_пароль"
     }
    ```
    Ответ содержит **access** и **refresh** токены.

3. **Обновление JWT токена**:
    
   URL: http://128.199.28.35/auth/token/refresh/

   Метод: POST

   Тело запроса:

   ```
    {
      "refresh": "ваш_refresh_токен"
    }
   ```
   
4. **Генерация токена для Telegram**:

   URL: http://128.199.28.35/api/users/get-telegram-token/

   Метод: GET

   Заголовки:

   ```
    {
      "Authorization": "Bearer ваш_access_токен"
    }
   ```
   
5. **Получение списка всех пользователей**

   URL: http://128.199.28.35/api/users/

   Метод: GET

   Заголовки:

   ```
    {
      "Authorization": "Bearer ваш_access_токен"
    }
   ```
   
6. **Отправка сообщения**:

   URL: http://128.199.28.35/api/messages/

   Метод: POST

   Заголовки:

   ```
    {
      "Authorization": "Bearer ваш_access_токен"
    }
   ```
   
   Тело запроса:

   ```
    {
      "text": "текст_вашего_сообщения"
    }
   ```
    
7. **Просмотр своих сообщений**:

   URL: http://128.199.28.35/api/messages/

   Метод: GET

   Заголовки:

   ```
    {
      "Authorization": "Bearer ваш_access_токен"
    }
   ```
   Ответ: Возвращает список всех сообщений, отправленных и полученных вами.


**Внимание:** После запроса 4 - **Генерация токена для Telegram**

Вы переходите в телеграм бота @Factoryest_bot и отправляете команду **/start**

Далее, отправляете ему Телеграмм токен, который вы получили.

После привязки, бот пишет что вы успешно привязаны!

Далее, после запроса 6 - **Отправка сообщения**. 

Все ваши сообщения дублируются в Телеграм бота в таком формате:



{Имя пользователя}, я получил от тебя сообщение:

{Сообщение}

Пример:

![img.png](img.png)
